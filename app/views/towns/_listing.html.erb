<script>
    $(document).ready(function(){
        $('[data-toggle="popover"]').popover();
    });
</script>

<div class="container">
  <div class="row">
    <% @towns.each do |town| %>
      <div class="col-md-4">
        <div class="card bg-dark">
          <%= image_tag("towny_background.png", :alt => "logo", class: "card-img-top") %>
          <h5 class="card-header">
            <a class="collapsed d-block" data-toggle="collapse" href="#<%= town.name.gsub(' ', '-') %>" aria-expanded="true" aria-controls="collapse-collapsed" id="heading-collapsed">
              <i class="fa fa-chevron-down pull-right"></i>
              <%= town.name %>
            </a>
          </h5>
          <div id="<%= town.name.gsub(' ', '-') %>" class="collapse" aria-labelledby="heading-collapsed">
            <div class="card-body text-white">
              <hr/>
              <% unless town.nation.eql?('') %>
                <p><b>Naci√≥n: </b>
                  <%=  town.nation  %>
                </p>
              <% end %>
              <% unless town.townBoard.eql?('/town set board [msg]') or town.townBoard.eql?('')%>
                <p><b>Board: </b>
                  <%=  town.townBoard  %>
                </p>
              <% end %>
              <p><b>Alcalde: </b>
                <% begin @mayor_uuid = Minecraft::Data.username_to_uuid(town.mayor) %>
                  <img class="resident-head" src="<%= Minecraft::Data.head_url_of(@mayor_uuid, true, 26) %>" title="<%= town.mayor %>" alt="">
                  <% rescue %>
                  <img class="resident-head" src="<%=  Minecraft::Data.head_url_of(Minecraft::Data::STEVE_UUID, false, 26) %>" alt="">
                <% end %>
                <b><%= town.mayor %></b>
              </p>
              <hr/>
              <p><b>Residentes: </b>
              </p>
              <div class="row">
                <% town.residents.split('#') do |resident| %>
                  <div class="col-md-1 col-sm-6 resident-entry">
                    <a style="cursor: pointer" data-toggle="popover" data-content="<%=  resident  %>" data-placement="top">
                      <% begin @resident_uuid = Minecraft::Data.username_to_uuid(resident) %>
                        <img class="resident-head" src="<%=  Minecraft::Data.head_url_of(@resident_uuid, true, 26) %>" alt="">
                        <% rescue %>
                        <img class="resident-head" src="<%=  Minecraft::Data.head_url_of(Minecraft::Data::STEVE_UUID, false, 26)  %>" alt="">
                      <% end %>
                    </a>
                  </div>
                <% end %>
              </div>
              <hr/>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
